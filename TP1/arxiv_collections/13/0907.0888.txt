We present a computational scheme allowing for a self-consistent treatment of
a dispersive metallic photonic metamaterial coupled to a gain material
incorporated into the nanostructure. The gain is described by a generic
four-level system. A critical pumping rate exists for compensating the loss of
the metamaterial. Nonlinearities arise due to gain depletion beyond a certain
critical strength of a test field. Transmission, reflection, and absorption
data as well as the retrieved effective parameters are presented for a lattice
of resonant square cylinders embedded in layers of gain material and split ring
resonators with gain material embedded into the gaps.