We describe the interplay between d-wave superconductivity and spin density
wave (SDW) order in a theory of the hole-doped cuprates at hole densities below
optimal doping. The theory assumes local SDW order, and associated electron and
hole pocket Fermi surfaces of charge carriers in the normal state. We describe
quantum and thermal fluctuations in the orientation of the local SDW order,
which lead to d-wave superconductivity: we compute the superconducting critical
temperature and magnetic field in a `minimal' universal theory. We also
describe the back-action of the superconductivity on the SDW order, showing
that SDW order is more stable in the metal. Our results capture key aspects of
the phase diagram of Demler et al. (cond-mat/0103192) obtained in a
phenomenological quantum theory of competing orders. Finally, we propose a
finite temperature crossover phase diagram for the cuprates. In the metallic
state, these are controlled by a `hidden' quantum critical point near optimal
doping involving the onset of SDW order in a metal. However, the onset of
superconductivity results in a decrease in stability of the SDW order, and
consequently the actual SDW quantum critical point appears at a significantly
lower doping.
  All our analysis is placed in the context of recent experimental results.