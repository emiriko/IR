See the pdf for details