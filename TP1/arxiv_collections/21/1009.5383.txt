We reconsider Sommerfeld-enhanced annihilation of dark matter (DM) into
leptons to explain PAMELA and Fermi electron and positron observations, in
light of possible new effects from substructure. There is strong tension
between getting a large enough lepton signal while respecting constraints on
the fluxes of associated gamma rays. We first show that these constraints
become significantly more stringent than in previous studies when the
contributions from background e^+ e^- are taken into account, so much so that
even cored DM density profiles are ruled out. We then show how DM annihilations
within subhalos can get around these constraints. Specifically, if most of the
observed lepton excess comes from annihilations in a nearby (within 1 kpc)
subhalo along a line of sight toward the galactic center, it is possible to
match both the lepton and gamma ray observations. We demonstrate that this can
be achieved in a simple class of particle physics models in which the DM
annihilates via a hidden leptophilic U(1) vector boson, with explicitly
computed Sommerfeld enhancement factors. Gamma ray constraints on the main halo
annihilations (and CMB constraints from the era of decoupling) require the
annihilating component of the DM to be subdominant, of order 10^-2 of the total
DM density.