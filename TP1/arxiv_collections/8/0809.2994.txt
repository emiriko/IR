We first construct a derived equivalence between a small crepant resolution
of an affine toric Calabi-Yau 3-fold and a certain quiver with a
superpotential. Under this derived equivalence we establish a wall-crossing
formula for the generating function of the counting invariants of perverse
coherent systems. As an application we provide certain equations on
Donaldson-Thomas, Pandeharipande-Thomas and Szendroi's invariants. Finally, we
show that moduli spaces associated with a quiver given by successive mutations
are realized as the moduli spaces associated the original quiver by changing
the stability conditions.