We give a criterion under which one can obtain a good decomposition (in the
sense of Malgrange) of a formal flat connection on a complex analytic or
algebraic variety of arbitrary dimension. The criterion is stated in terms of
the spectral behavior of differential operators, and generalizes Robba's
construction of the Hukuhara-Levelt-Turrittin decomposition in the
one-dimensional case. As an application, we prove the existence of good formal
structures for flat meromorphic connections on surfaces after suitable blowing
up; this verifies a conjecture of Sabbah, and extends a result of Mochizuki for
algebraic connections. Our proof uses a finiteness argument on the valuative
tree associated to a point on a surface, in order to verify the numerical
criterion.