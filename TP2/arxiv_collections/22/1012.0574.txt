We describe an updated version of our hybrid N-body-coagulation code for
planet formation. In addition to the features of our 2006-2008 code, our
treatment now includes algorithms for the 1D evolution of the viscous disk, the
accretion of small particles in planetary atmospheres, gas accretion onto
massive cores, and the response of N-bodies to the gravitational potential of
the gaseous disk and the swarm of planetesimals. To validate the N-body portion
of the algorithm, we use a battery of tests in planetary dynamics. As a first
application of the complete code, we consider the evolution of Pluto-mass
planetesimals in a swarm of 0.1-1 cm pebbles. In a typical evolution time of
1-3 Myr, our calculations transform 0.01-0.1 solar mass disks of gas and dust
into planetary systems containing super-Earths, Saturns, and Jupiters. Low mass
planets form more often than massive planets; disks with smaller alpha form
more massive planets than disks with larger alpha. For Jupiter-mass planets,
masses of solid cores are 10-100 Earth masses.