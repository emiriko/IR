We investigate if the discrepancy between estimates of the total baryon mass
fraction obtained from observations of the cosmic microwave background (CMB)
and of galaxy groups/clusters persists when a large sample of groups is
considered.
  To this purpose, 91 candidate X-ray groups/poor clusters at redshift 0.1 < z
< 1 are selected from the COSMOS 2 deg^2 survey, based only on their X-ray
luminosity and extent. This sample is complemented by 27 nearby clusters with a
robust, analogous determination of the total and stellar mass inside R_500. The
total sample of 118 groups and clusters with z < 1 spans a range in M_500 of
~10^13--10^15 M_sun. We find that the stellar mass fraction associated with
galaxies at R_500 decreases with increasing total mass as (M_500)^-0.37 \pm
0.04, independent of redshift. Estimating the total gas mass fraction from a
recently derived, high quality scaling relation, the total baryon mass fraction
(f_500^stars+gas=f_500^stars+f_500^gas) is found to increase by ~ 25% when
M_500 increases from <M>=5 X 10^13 M_sun to <M> = 7 X 10^14 M_sun. After
consideration of a plausible contribution due to intra--cluster light (11--22%
of the total stellar mass), and gas depletion through the hierarchical assembly
process (10% of the gas mass), the estimated values of the total baryon mass
fraction are still lower than the latest CMB measure of the same quantity
(WMAP5), at a significance level of 3.3\sigma for groups of <M>=5 X
10^13~M_sun. The discrepancy decreases towards higher total masses, such that
it is 1\sigma at <M>= 7 X 10^14~M_sun. We discuss this result in terms of
non--gravitational processes such as feedback and filamentary heating.