A model for beam customization with collimators and a range-compensating
filter based on the phase-space theory for beam transport is presented for dose
distribution calculation in treatment planning of radiotherapy with protons and
heavier ions. Independent handling of pencil beams in conventional pencil-beam
algorithms causes unphysical collimator-height dependence in the middle of
large fields, which is resolved by the framework comprised of generation,
transport, collimation, regeneration, range-compensation, and edge-sharpening
processes with a matrix of pencil beams. The model was verified to be
consistent with measurement and analytic estimation at a submillimeter level in
penumbra of individual collimators with a combinational-collimated carbon-ion
beam. The model computation is fast, accurate, and readily applicable to
pencil-beam algorithms in treatment planning with capability of combinational
collimation to make best use of the beam-customization devices.