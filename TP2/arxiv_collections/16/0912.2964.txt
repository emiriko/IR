The supernova paradigm for the origin of galactic cosmic rays has been deeply
affected by the development of the non-linear theory of particle acceleration
at shock waves. Here we discuss the implications of applying such theory to the
calculation of the spectrum of cosmic rays at Earth as accelerated in supernova
remnants and propagating in the Galaxy. The spectrum is calculated taking into
account the dynamical reaction of the accelerated particles on the shock, the
generation of magnetic turbulence which enhances the scattering near the shock,
and the dynamical reaction of the amplified field on the plasma. Most
important, the spectrum of cosmic rays at Earth is calculated taking into
account the flux of particles escaping from upstream during the Sedov-Taylor
phase and the adiabatically decompressed particles confined in the expanding
shell and escaping at later times. We show how the spectrum obtained in this
way is well described by a power law in momentum with spectral index close to
-4, despite the concave shape of the instantaneous spectra of accelerated
particles. On the other hand we also show how the shape of the spectrum is
sensible to details of the acceleration process and environment which are and
will probably remain very poorly known.