We study the stochastic control problem of maximizing expected utility from
terminal wealth under a non-bankruptcy constraint. The wealth process is
subject to shocks produced by a general marked point process. The problem of
the agent is to derive the optimal insurance strategy which allows "lowering"
the level of the shocks. This optimization problem is related to a suitable
dual stochastic control problem in which the delicate boundary constraints
disappear. We characterize the dual value function as the unique viscosity
solution of the corresponding a Hamilton Jacobi Bellman Variational Inequality
(HJBVI in short).