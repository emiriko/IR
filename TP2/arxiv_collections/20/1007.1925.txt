We describe a semi-analytical approach to non-linear diffusive shock
acceleration in the case in which nuclei other than protons are also
accelerated. The structure of the shock is determined by the complex interplay
of all nuclei, and in turn this shock structure determines the spectra of all
components. The magnetic field amplification upstream is described as due to
streaming instability of all nuclear species. The amplified magnetic field is
then taken into account for its dynamical feedback on the shock structure as
well as in terms of the induced modification of the velocity of the scattering
centers that enters the particle transport equation. The spectra of accelerated
particles are steep enough to be compared with observed cosmic ray spectra only
if the magnetic field is sufficiently amplified and the scattering centers have
high speed in the frame of the background plasma. We discuss the implications
of this generalized approach on the structure of the knee in the all-particle
cosmic ray spectrum, which we interpret as due to an increasingly heavier
chemical composition above $10^{15}$eV. The effects of a non trivial chemical
composition at the sources on the gamma ray emission from a supernova remnant
when gamma rays are of hadronic origin are also discussed.