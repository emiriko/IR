We study equations on a principal bundle over a compact complex manifold
coupling connections on the bundle with K\"ahler structures in the base. These
equations generalize the conditions of constant scalar curvature for a K\"ahler
metric and Hermite-Yang-Mills for a connection. We provide a moment map
interpretation of the equations and study obstructions for the existence of
solutions, generalizing the Futaki character and the Mabuchi K-energy. We
explain their relationship to the algebro-geometric moduli problem for pairs
consisting of a polarized variety and a holomorphic vector bundle.